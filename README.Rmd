---
output: github_document
---
<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/",
  out.width = "100%"
)
```

# greenfeedr  <img src="man/figures/GFSticker.png" align="right" width="15.2%"/>

<!-- badges: start -->
[![CRAN Status](https://www.r-pkg.org/badges/version/greenfeedr)](https://CRAN.R-project.org/package=greenfeedr)
![CRAN Downloads](https://cranlogs.r-pkg.org/badges/grand-total/greenfeedr)
![CRAN Downloads](https://cranlogs.r-pkg.org/badges/last-month/greenfeedr)
<!-- badges: end -->


## Overview

**greenfeedr** provides a set of functions that help you work with GreenFeed data:

* `get_gfdata()` downloads GreenFeed data via API.
* `report_gfdata()` downloads and generates markdown reports of preliminary and finalized GreenFeed data.
* `compare_gfdata()` compare preliminary and finalized GreenFeed data.
* `process_gfdata()` processes and averages preliminary or finalized GreenFeed data.
* `pellin()` processes pellet intakes from GreenFeed units.
* `viseat()` processes GreenFeed visits.

## Citation

More information about how to use greenfeedr can be found in [Martinez-Boggio et al. (2024)](https://doi.org/10.3168/jdsc.2024-0662).

## Cheat Sheet

<a href="https://github.com/GMBog/greenfeedr/raw/main/man/figures/Cheatsheet.pdf"><img src="https://github.com/GMBog/greenfeedr/raw/main/man/figures/Cheatsheet.png" width="480" height="360"/></a>

## Installation

To install the latest stable release of `greenfeedr` from [CRAN](https://CRAN.R-project.org/package=greenfeedr), use:

```{r CRAN, eval = FALSE}
install.packages("greenfeedr")
```

For the development version with the latest updates, install it from GitHub:

```{r GitHub, eval = FALSE}
install.packages("remotes")
remotes::install_github("GMBog/greenfeedr")
```

## Usage

```{r libraries, include = FALSE, message = FALSE}
library(dplyr)
library(purrr)
library(readxl)
```

### Example: Using `process_gfdata()`: 

```{r setup, message = FALSE}
library(greenfeedr)
```

You can process either preliminary data obtained via the API using `get_gfdata()` or finalized data downloaded from the [GreenFeed web interface](https://ext.c-lockinc.com/greenfeed/data.php).

Before diving into the analysis, let's examine the dataset structure. Below are the first five column names:

```{r data, echo = FALSE, message = FALSE, results = 'asis'}
# Load the data
finaldata <- readxl::read_excel(system.file("extdata", "StudyName_FinalReport.xlsx", package = "greenfeedr"))

# Convert RFID to character format
finaldata$RFID <- as.character(finaldata$RFID)

# Display column names in a table format
knitr::kable(data.frame("Column Name" = colnames(finaldata)), 
             format = "html", table.attr = "style='font-size: 12px;'")
```

Before proceeding with analysis, it's useful to summarize key aspects of the dataset:

  * Total number of records
  * Records per day
  * Days with records per week
  * Weeks with records

#### Using process_gfdata()

To analyze the data effectively, we will use `process_gfdata()`, which requires three arguments:

* **`param1`** is the number of records per day. 
  * This parameter controls the minimum number of records that must be present for each day in the dataset to be considered valid.

* **`param2`** is the number of days with records per week. 
  * This parameter ensures that a minimum number of days within a week have valid records to be included in the analysis.

* **`min_time`** is the minimum duration of a record. 
  * This parameter specifies the minimum time threshold for each record to be considered valid.

To determine the best-fitting parameters for our dataset, we will use the `eval_param()` function.

```{r parameters}
# Define the parameter space for param1 (i), param2 (j), and min_time (k):
i <- seq(1, 6)
j <- seq(1, 7)
k <- seq(2, 6)

# Generate all combinations of i, j, and k
param_combinations <- expand.grid(param1 = i, param2 = j, min_time = k)
```

In total, we have `r nrow(param_combinations)` different parameter combinations to evaluate.

The next step is to evaluate the `process_gfdata()` function with the set of parameters we defined. The function can accept either a file path to the data files or the data as a data frame.

```{r Example, message = FALSE, results = 'hide'}
data <- eval_gfparam(data = finaldata,
                     start_date = "2024-05-13",
                     end_date = "2024-05-25"
                     )
```

After evaluating the function, the results will be placed into a data frame with the following structure:

```{r Results table, echo = FALSE, message = FALSE, results = 'asis'}
cat(knitr::kable(data[1:10, ], format = "html", table.attr = "style='font-size: 12px;'"))
```

This will give users a sense of how the data is filtered based on the chosen parameters. A more conservative approach (i.e., stricter parameters) will typically result in fewer retained records and animals.

## Getting help

If you encounter a clear bug, please file an issue with a minimal reproducible example on [GitHub](https://github.com/GMBog/greenfeedr).

## Premium Version  

A **premium version** is available, specifically designed for **commercial setup**. It includes advanced features optimized for **large-scale data processing, enhanced analytics, and dedicated support**.  

For more details, please contact [Guillermo Martinez-Boggio](guillermo.martinezboggio@wisc.edu).

